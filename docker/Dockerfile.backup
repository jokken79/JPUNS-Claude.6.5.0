FROM postgres:15-alpine

# Install required tools for backup operations
RUN apk add --no-cache \
    bash \
    dcron \
    gzip \
    postgresql-client

# Set working directory
WORKDIR /scripts

# Copy backup scripts
COPY docker/backup/backup.sh /scripts/backup.sh
COPY docker/backup-entrypoint.sh /entrypoint.sh

# Make scripts executable
RUN chmod +x /scripts/backup.sh /entrypoint.sh

# Create backup directory
VOLUME ["/backups"]

# Set entrypoint and default command
ENTRYPOINT ["/entrypoint.sh"]
CMD ["/scripts/backup.sh", "start"]
